<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Password-based Encryption / Decryption</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: system-ui, sans-serif; background:#0f172a; color:#e6eef8; margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px; }
    .card { background:#111d3a; padding:20px; border-radius:14px; max-width:500px; width:100%; box-shadow:0 6px 18px rgba(0,0,0,0.6); }
    h2 { margin-top:0; text-align:center; }
    label { display:block; margin-top:12px; font-weight:600; }
    textarea, input[type="password"] { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #2d3f5c; background:#071427; color:#e6eef8; resize:vertical; min-height:50px; }
    button { margin-top:12px; padding:10px; width:48%; border:none; border-radius:10px; background:#2563eb; color:#fff; font-weight:600; cursor:pointer; transition:all 0.2s; }
    button:hover { background:#1d4ed8; }
    .btn-row { display:flex; justify-content:space-between; flex-wrap:wrap; gap:4px; }
    textarea[readonly] { background:#0b1325; }
    @media (max-width:600px){
      button { width:100%; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>üîê Encrypt / Decrypt</h2>
    
    <label>Password (used as key)</label>
    <input type="password" id="password" placeholder="Enter your secret password"/>
    
    <label>Message</label>
    
    <div class="btn-row">
      <button id="encryptBtn">Encrypt</button>
      <button id="decryptBtn">Decrypt</button>
    </div>
    
    <label>Encrypted Output</label>
    <textarea id="encrypted" readonly></textarea>
    
    <label>Decrypted Output</label>
    <textarea id="decrypted" readonly></textarea>
  </div>
  
<script>
const enc = new TextEncoder();
const dec = new TextDecoder();

// Derive AES key from password using PBKDF2
async function deriveKey(password, salt){
  const keyMaterial = await crypto.subtle.importKey(
    "raw", enc.encode(password), {name:"PBKDF2"}, false, ["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {name:"PBKDF2", salt, iterations:100000, hash:"SHA-256"},
    keyMaterial,
    {name:"AES-GCM", length:256},
    false,
    ["encrypt","decrypt"]
  );
}

// Encrypt function
async function encryptMessage(password, message){
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await deriveKey(password, salt);
  const ciphertext = await crypto.subtle.encrypt({name:"AES-GCM", iv}, key, enc.encode(message));
  // Combine salt+iv+ciphertext
  const combined = new Uint8Array(salt.byteLength + iv.byteLength + ciphertext.byteLength);
  combined.set(salt, 0);
  combined.set(iv, salt.byteLength);
  combined.set(new Uint8Array(ciphertext), salt.byteLength + iv.byteLength);
  return btoa(String.fromCharCode(...combined));
}

// Decrypt function
async function decryptMessage(password, dataB64){
  try {
    const data = Uint8Array.from(atob(dataB64), c => c.charCodeAt(0));
    const salt = data.slice(0,16);
    const iv = data.slice(16,28);
    const ciphertext = data.slice(28);
    const key = await deriveKey(password, salt);
    const plaintext = await crypto.subtle.decrypt({name:"AES-GCM", iv}, key, ciphertext);
    return dec.decode(plaintext);
  } catch (e){
    return "‚ùå Wrong password or corrupted data";
  }
}

// Button actions
document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const password = document.getElementById('password').value;
  const message = document.getElementById('message').value;
  if(!password){ alert("Enter a password!"); return; }
  const encrypted = await encryptMessage(password, message);
  document.getElementById('encrypted').value = encrypted;
  document.getElementById('decrypted').value = "";
});

document.getElementById('decryptBtn').addEventListener('click', async ()=>{
  const password = document.getElementById('password').value;
  const data = document.getElementById('encrypted').value.trim();
  if(!password){ alert("Enter a password!"); return; }
  if(!data){ alert("No encrypted text"); return; }
  const decrypted = await decryptMessage(password, data);
  document.getElementById('decrypted').value = decrypted;
});
</script>
</body>
</html>
